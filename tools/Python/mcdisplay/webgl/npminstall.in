#!/usr/bin/env bash
@MCCODE_BASH_STANDARD_PREAMBLE@

set -e

VERSIONDIR=@MCCODE_VERSION@
if [ ! -z "${CONDA_DEFAULT_ENV}" ];
then
    THISENV=`basename ${CONDA_DEFAULT_ENV}`
    VERSIONDIR=${VERSIONDIR}_${THISENV}
fi

cd ${HOME} && mkdir -p .@FLAVOR@ && cd .@FLAVOR@ && mkdir -p ${VERSIONDIR} && cd ${VERSIONDIR} && mkdir -p webgl && cd webgl

FILE=${0}
TOOLDIR=`dirname $FILE`
cp ${TOOLDIR}/*.tsx .
cp ${TOOLDIR}/*.css .
cp ${TOOLDIR}/index.html .
cp ${TOOLDIR}/*.js .
cp ${TOOLDIR}/package.json .
rsync -avz ${TOOLDIR}/Contexts/ Contexts
rsync -avz ${TOOLDIR}/utils/ utils
rsync -avz ${TOOLDIR}/data-utils/ data-utils
rsync -avz ${TOOLDIR}/components/ components
npm install
npm run build
